<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






  <link rel="stylesheet" type="text/css" href="vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="css/main.css?v=0.4.2"/>


    <meta name="description" content="在码农炼成之路不断挣扎……stay hungry……keep learning……" />



  <meta name="keywords" content="java,android,life,CharlesXiao" />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.2" />



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?6749450";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  <title> CharlesXiao‘s Blog </title>
</head>

<body>
<!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">CharlesXiao‘s Blog</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>


  <ul id="menu" class="menu">
     
    <!--增加swiftype搜索功能-->
    <form class="menu-item menu-item-search">
      <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
    </form>
    
    <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

      _st('install','yxUhPQ2aHyszT_1btxX9','2.0.0');
    </script>
    <!--增加swiftype搜索功能end-->
    
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          首页
        </a>
      </li>
    
      
      <li class="menu-item menu-item-categories">
        <a href="/categories">
          <i class="menu-item-icon icon-categories"></i> <br />
          分类
        </a>
      </li>
    
      
      <li class="menu-item menu-item-about">
        <a href="/about">
          <i class="menu-item-icon icon-about"></i> <br />
          关于
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          归档
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          标签
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <div id="posts" class="posts-expand">
    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2017/12/09/Mysql 长连接与短连接/">
                Mysql 长连接与短连接
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2017-12-09
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="2017/12/09/Mysql 长连接与短连接/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2017/12/09/Mysql 长连接与短连接/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <h4 id="概念说明">概念说明</h4><ol>
<li><strong>短连接</strong>：是指程序和数据库通信时需要建立连接，执行操作后，连接关闭。短连接简单来说就是每一次操作数据库，都要打开和关闭数据库连接，基本步骤是：连接→数据传输→关闭连接。</li>
<li><strong>长连接</strong>：是指程序之间的连接在建立之后，就一直打开，被后续程序重用，基本步骤是：连接→数据传输→保持连接→数据传输……。使用长连接的初衷是减少连接的开销，尽管MySQL的连接比其他数据库要快得多。长连接在没有数据通信时，定时发送数据包，以维持连接状态。</li>
<li><strong>数据库连接池</strong>：是一些网络代理服务或应用服务器实现的特性，如J2EE服务器，它实现了一个持久连接的“池”，允许其他程序、客户端来连接，这个连接池将被所有连接的客户端共享使用，连接池可以节省打开数据库的时间，加速连接，也可以减少数据库连接，降低数据库服务器的负载；它是预先打开N个数据库连接，把它们缓存起来，当需要使用数据库的时候就直接使用这些已经打开的连接，节省时间</li>
<li><strong>J2EE数据库连接池的原理</strong>：<ul>
<li>J2EE服务器启动时会建立一定数量的池连接，并一直维持不少于此数目的池连接。</li>
<li>客户端程序需要连接时，池驱动程序会返回一个未使用的池连接并将其表记为忙。</li>
<li>如果当前没有空闲连接，池驱动程序就新建一定数量的连接，新建连接的数量由配置参数决定。</li>
<li>当使用的池连接调用完成后，池驱动程序将此连接表记为空闲，其他调用就可以使用这个连接。</li>
</ul>
</li>
</ol>
<h4 id="适用场景">适用场景</h4><ol>
<li><strong>长连接优劣势</strong><ul>
<li>从客户端的角度来说，使用长连接可以不用每次创建新连接，若客户端对MySQL服务器的连接请求很频繁，永久连接将更加高效。</li>
<li>从服务器的角度来看，情况则略有不同，它可以节省创建连接的开销，但维持连接也是需要内存的。如果滥用长连接的话，可能会使用过多的MySQL服务器连接。现代的操作系统可以拥有几千个MySQL连接，但很有可能绝大部分都是睡眠（sleep）状态的，这样的工作方式不够高效，而且连接占据内存，也会导致内存的浪费。</li>
</ul>
</li>
<li><strong>长连接主要用于在少数客户端与服务端的频繁通信</strong>，因为这时候如果用短连接频繁通信常会发生Socket出错，并且频繁创建Socket连接也是对资源的浪费；但是对于服务端来说，长连接也会耗费一定的资源，需要专门的线程（unix下可以用进程管理）来负责维护连接状态。</li>
<li><strong>长连接</strong>是一些驱动、驱动框架、ORM工具的特性，由驱动来保持连接句柄的打开，以便后续的数据库操作可以重用连接，从而减少数据库的连接开销。而<strong>连接池</strong>是应用服务器的组件，它可以通过参数来配置连接数、连接检测、连接的生命周期等。</li>
</ol>
<h4 id="注意事项">注意事项</h4><ol>
<li>我们一般使用mysql -uroot -p只不过是使用了管理员的身份来创建一个connection，从而登录mysql，mysql的连接过程，内部实际上是经过tcp/ip协议的，当然mysql封装了tcp/ip有自己的一套协议。mysql是会创建一个线程来处理到来的连接的，我们可以在mysql中show status;然后在连接mysql，再次show status就可以看到Thread_connected的数量会增加1</li>
<li>在生产繁忙的系统中，连接也可能会受到系统端口数的限制，如果要每秒建立几千个连接，那么连接断开后，端口不会被马上回收利用，必须经历一个“FIN”阶段的等待，直到可被回收利用为止，这样就可能会导致端口资源不够用。</li>
<li>如果客户端和MySQL数据库之间有连接池或Proxy代理，一般在客户端推荐使用短连接。对于长连接的使用一定要慎重，不可滥用</li>
<li>如果使用了长连接而长期没有对数据库进行任何操作，那么在timeout值(默认8小时)后，mysql server就会关闭此连接，而客户端在执行查询的时候就会得到一个类似于“MySQL server has gone away“这样的错误。在使用mysql_real_connect连接数据库之后，再使用mysql_options( &amp;mysql, MYSQL_OPT_RECONNECT, … ) 来设置为自动重连。</li>
</ol>
<h4 id="常用工具">常用工具</h4><ol>
<li>查看mysql连接数：<code>mysqladmin -uroot -p  processlist</code></li>
<li>查看linux系统端口占用信息和进程信息：<ul>
<li><code>ps aux</code>只能看到pid等信息，不能看到端口号</li>
<li><code>lsof | grep pid/pname</code> 查看进程信息</li>
<li><code>lsof -i :port</code>查看端口号port使用的进程号和连接情况</li>
<li><code>lsof -i@ip:port</code>使用@host:port来显示指定到指定主机的连接</li>
<li><code>lsof -iTCP</code>显示TCP连接</li>
<li><code>netstat -np/c/atux | grep pid/port/pname</code>查看进程号所占用的端口号和端口占用情况</li>
</ul>
</li>
</ol>

        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="tags/Mysql/"> #Mysql </a>
          
            <a href="tags/databse/"> #databse </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2017/12/07/Linux终端利器tmux指南/">
                Linux终端利器tmux指南
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2017-12-07
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="2017/12/07/Linux终端利器tmux指南/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2017/12/07/Linux终端利器tmux指南/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <h4 id="tmux简介">tmux简介</h4><p>tmux是BSD实现的Screen替代品，相对于Screen，它更加先进：支持屏幕切分，而且具备丰富的命令行参数，使其可以灵活、动态的进行各种布局和操作。它可以做到一条命令就启动起来(强大的配置)</p>
<h5 id="安装方法">安装方法</h5><table>
<thead>
<tr>
<th>系统</th>
<th>安装命令</th>
</tr>
</thead>
<tbody>
<tr>
<td>mac</td>
<td><figure class="highlight"><figcaption><span>install tmux```（前提需要安装homebrew)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubuntu | ```sudo apt-get install tmux</span><br></pre></td></tr></table></figure></td>
</tr>
</tbody>
</table>
<p>centos | <figure class="highlight"><figcaption><span>install -y tmux```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#20854;&#23427; | &#19979;&#36733;&#28304;&#30721;&#37197;&#32622;-&#32534;&#35793;-&#38142;&#25509;-&#23433;&#35013;&#10;&#10;##### &#27010;&#24565;&#21517;&#35789;&#10;&#22312;&#20320;&#36755;&#20837;tmux&#24320;&#21551;&#20102;tmux&#26381;&#21153;&#22120;&#21518;&#65292;&#20250;&#39318;&#20808;&#21019;&#24314;&#19968;&#20010;&#20250;&#35805;&#65292;&#32780;&#36825;&#20010;&#20250;&#35805;&#21017;&#20250;&#39318;&#20808;&#21019;&#24314;&#19968;&#20010;&#31383;&#21475;&#65292;&#20854;&#20013;&#20165;&#21253;&#21547;&#19968;&#20010;&#38754;&#26495;; &#20063;&#23601;&#26159;&#35828;&#65292;&#36825;&#37324;&#30475;&#21040;&#30340;&#25152;&#35859;&#32456;&#31471;&#25511;&#21046;&#21488;&#24212;&#35813;&#31216;&#20316;tmux&#30340;&#19968;&#20010;&#38754;&#26495;&#65292;&#34429;&#28982;&#20854;&#20351;&#29992;&#26041;&#27861;&#19982;&#32456;&#31471;&#25511;&#21046;&#21488;&#23436;&#20840;&#30456;&#21516;&#12290;&#10;&#10;| &#27010;&#24565; | &#35828;&#26126; |&#10;| --- | --- |&#10;| server&#26381;&#21153;&#22120; | &#36755;&#20837;tmux&#21629;&#20196;&#26102;&#23601;&#24320;&#21551;&#20102;&#19968;&#20010;&#26381;&#21153;&#22120; |&#10;| session&#20250;&#35805; | &#19968;&#20010;&#26381;&#21153;&#22120;&#21487;&#20197;&#21253;&#21547;&#22810;&#20010;&#20250;&#35805; |&#10;| window&#31383;&#21475; | &#36890;&#36807;c-b-c&#21019;&#24314;&#65292;&#25152;&#26377;&#31383;&#21475;&#30340;&#21517;&#31216;&#26174;&#31034;&#22312;&#24213;&#37096;&#29366;&#24577;&#26639;&#19978;&#65292;&#19968;&#20010;&#20250;&#35805;&#21487;&#20197;&#21253;&#21547;&#22810;&#20010;&#31383;&#21475; |&#10;| pane&#38754;&#26495; | &#31383;&#21475;&#37324;&#38754;&#30340;&#20998;&#23631;&#65292;&#21487;&#36890;&#36807;c-b-%&#21019;&#24314;&#65292;&#19968;&#20010;&#31383;&#21475;&#21487;&#20197;&#21253;&#21547;&#22810;&#20010;&#38754;&#26495; |&#10;&#10;##### &#20351;&#29992;&#22330;&#26223;&#21644;&#20248;&#28857;&#10;1. tmux&#21629;&#20196;&#24320;&#21551;&#19968;&#20010;&#32456;&#31471;&#20043;&#21518;&#65292;&#21487;&#20197;&#22312;&#36825;&#20010;&#32456;&#31471;&#37324;&#24320;&#21551;&#22810;&#20010;windows&#65292;&#21516;&#26102;&#36824;&#21487;&#20197;&#25226;windows split&#25104;&#22810;&#20010;pane&#65292;&#24182;&#34892;&#24037;&#20316;&#10;2. ssh&#30331;&#24405;&#36828;&#31243;&#20027;&#26426;&#30340;&#24773;&#26223;&#19979;&#65292;&#19968;&#26086;ssh&#26029;&#24320;&#65292;&#37027;&#20040;&#24403;&#21069;&#36134;&#25143;&#30331;&#24405;&#30340;&#20219;&#21153;&#23601;&#34987;&#21462;&#28040;&#20102;&#65292;&#20294;&#26159;&#20351;&#29992; tmux &#21487;&#20197;&#22312;&#26029;&#24320;&#20043;&#21518;&#32487;&#32493;&#24037;&#20316;&#65292;&#19979;&#27425;&#30331;&#24405;&#21487;&#20197;&#26597;&#30475;&#10;&#10;#### &#24120;&#29992;&#40664;&#35748;&#24555;&#25463;&#38190;&#10;tmux&#37324;&#36793;&#25152;&#26377;&#24555;&#25463;&#38190;&#37117;&#40664;&#35748;&#20197;c-b&#20316;&#20026;&#21069;&#32512;&#65292;&#20063;&#23601;&#26159;&#20197;ctrl+b&#24320;&#22836;&#65292;&#24403;&#28982;&#20320;&#20063;&#21487;&#20197;&#33258;&#34892;&#37197;&#32622;&#65307;&#10;&#10;1. &#22522;&#26412;&#21629;&#20196;&#10;&#9;* ``` tmux ```&#21019;&#24314;&#19968;&#20010;tmux session&#10;&#9;* ``` tmux new -s session_name ```&#21019;&#24314;&#19968;&#20010;&#21483;&#20570;session_name&#30340; session&#10;&#9;* ``` tmux ls\tmux list-sessions ```&#21015;&#20986;&#29616;&#26377;&#30340;&#25152;&#26377;session&#10;&#9;* ``` tmux info```&#21015;&#20986;&#25152;&#26377;&#30340; session, window, pane, &#36816;&#34892;&#30340;&#36827;&#31243;&#21495;&#31561;&#10;&#9;* ``` tmux list-keys ```&#21015;&#20986;&#25152;&#26377;&#21487;&#20197;&#30340;&#24555;&#25463;&#38190;&#21644;&#20854;&#36816;&#34892;&#30340; tmux &#21629;&#20196;&#10;&#9;* ``` tmux list-commands ```&#21015;&#20986;&#25152;&#26377;&#30340; tmux &#21629;&#20196;&#21450;&#20854;&#21442;&#25968;&#10;&#9;* ``` tmux at(attach) -t session_name ```&#36827;&#20837;&#21483;&#20570;session_name&#30340;session&#10;&#9;* ``` tmux detach\c-b-d ```&#31163;&#24320;&#24403;&#21069;&#24320;&#21551;&#30340;session&#10;&#9;* ``` tmux kill-session -t session ```&#20851;&#38381;&#24320;&#21551;&#30340;session&#10;2. &#22522;&#26412;&#25805;&#20316;&#10;&#9;* ``` d ```&#33073;&#31163;&#24182;&#20445;&#23384;&#24403;&#21069;&#20250;&#35805;,&#21487;&#26242;&#26102;&#36820;&#22238;Shell&#30028;&#38754;,tmux&#20173;&#22312;&#21518;&#21488;&#36816;&#34892;&#10;&#9;* ``` ctrl + z ```&#25346;&#36215;&#24403;&#21069;&#20250;&#35805;&#10;&#9;* ``` s ```&#36873;&#25321;&#24182;&#20999;&#25442;&#20250;&#35805;&#65307;&#22312;&#21516;&#26102;&#24320;&#21551;&#20102;&#22810;&#20010;&#20250;&#35805;&#26102;&#20351;&#29992;&#10;&#9;* ``` D ```&#36873;&#25321;&#35201;&#33073;&#31163;&#30340;&#20250;&#35805;&#65307;&#22312;&#21516;&#26102;&#24320;&#21551;&#20102;&#22810;&#20010;&#20250;&#35805;&#26102;&#20351;&#29992;&#10;&#9;* ```: ```&#36827;&#20837;&#21629;&#20196;&#34892;&#27169;&#24335;&#65307;&#27492;&#26102;&#21487;&#36755;&#20837;&#25903;&#25345;&#30340;&#21629;&#20196;&#65292;&#20363;&#22914; kill-server &#20851;&#38381;&#25152;&#26377;tmux&#20250;&#35805;&#10;&#9;* ``` t ```&#26174;&#31034;&#24403;&#21069;&#30340;&#26102;&#38388;&#10;&#10;2. &#31383;&#21475;&#25805;&#20316;&#10;&#9;* ``` c ```&#21019;&#24314;&#26032;&#31383;&#21475;&#10;&#9;* ``` &#38; ```&#20851;&#38381;&#24403;&#21069;&#31383;&#21475;&#10;&#9;* ``` [0-9] ```&#25968;&#23383;&#38190;&#20999;&#25442;&#21040;&#25351;&#23450;&#31383;&#21475;&#10;&#9;* ``` p ```&#20999;&#25442;&#33267;&#19978;&#19968;&#31383;&#21475;&#10;&#9;* ``` n ```&#20999;&#25442;&#33267;&#19979;&#19968;&#31383;&#21475;&#10;&#9;* ``` l ```&#20999;&#25442;&#21040;&#26368;&#21518;&#20351;&#29992;&#30340;&#31383;&#21475;&#10;&#9;* ``` l ```&#21069;&#21518;&#31383;&#21475;&#38388;&#20114;&#30456;&#20999;&#25442;&#10;&#9;* ``` w ```&#36890;&#36807;&#31383;&#21475;&#21015;&#34920;&#20999;&#25442;&#31383;&#21475;&#10;&#9;* ``` , ```&#37325;&#21629;&#21517;&#24403;&#21069;&#31383;&#21475;&#65292;&#20415;&#20110;&#35782;&#21035;&#10;&#9;* ``` . ```&#20462;&#25913;&#24403;&#21069;&#31383;&#21475;&#32534;&#21495;&#65292;&#30456;&#24403;&#20110;&#37325;&#26032;&#25490;&#24207;&#10;&#9;* ``` f ```&#22312;&#25152;&#26377;&#31383;&#21475;&#20013;&#26597;&#25214;&#20851;&#38190;&#35789;&#65292;&#20415;&#20110;&#31383;&#21475;&#22810;&#20102;&#20999;&#25442;&#10;3. (&#38754;&#26495;)&#20998;&#23631;&#25805;&#20316;&#10;&#9;* ``` ? ```&#26174;&#31034;&#24555;&#25463;&#38190;&#24110;&#21161;&#10;&#9;* ``` &#34; ```&#23558;&#24403;&#21069;&#38754;&#26495;&#19978;&#19979;&#20998;&#23631;&#65288;&#24314;&#35758;&#35774;&#32622;&#25104; |&#65289;&#10;&#9;* ``` % ```&#23558;&#24403;&#21069;&#38754;&#26495;&#24038;&#21491;&#20998;&#23631;&#65288;&#24314;&#35758;&#35774;&#32622;&#25104; -&#65289;&#10;&#9;* ``` x ```&#20851;&#38381;&#24403;&#21069;&#20998;&#23631;&#10;&#9;* ``` q ```&#26174;&#31034;&#38754;&#26495;&#32534;&#21495;&#10;&#9;* ``` o ```&#36873;&#25321;&#24403;&#21069;&#31383;&#21475;&#20013;&#19979;&#19968;&#20010;&#38754;&#26495;&#10;&#9;* ``` ; ```&#20999;&#25442;&#21040;&#26368;&#21518;&#19968;&#20010;&#20351;&#29992;&#30340;&#38754;&#26495;&#10;&#9;* ``` &#26041;&#21521;&#38190; ```&#31227;&#21160;&#20809;&#26631;&#36873;&#25321;&#23545;&#24212;&#38754;&#26495;&#10;&#9;* ``` z ```&#26368;&#22823;&#21270;&#24403;&#21069;&#25152;&#22312;&#38754;&#26495;&#10;&#9;* ``` ! ```&#38754;&#26495;&#36716;&#21464;&#25104;&#31383;&#21475;&#10;&#10;#### &#25512;&#33616;&#37197;&#32622;&#10;&#22914;&#26524;&#20320;&#26377;&#20010;&#24615;&#21270;&#37197;&#32622;&#30340;&#38656;&#35201;&#65292;&#21253;&#25324;&#24555;&#25463;&#38190;&#65292;&#29366;&#24577;&#26639;&#31561;&#65292;&#37027;&#20040;&#20462;&#25913;~/.tmux.conf&#25991;&#20214;&#21487;&#20197;&#36798;&#21040;&#20320;&#30340;&#30446;&#30340;&#65292;&#35753;&#20320;&#29992;&#36215;&#26469;&#26356;&#31526;&#21512;&#33258;&#24049;&#30340;&#20064;&#24815;; &#20063;&#21487;&#20197;&#36890;&#36807;&#37197;&#32622;~/.bashrc&#27599;&#27425;ssh&#30331;&#24405;&#26102;&#37117;&#40664;&#35748;attach&#25110;&#32773;&#26032;&#24314;tmux&#20250;&#35805;&#10;&#10;1. tmux.conf&#37197;&#32622;&#24555;&#25463;&#38190;&#65292;&#37197;&#33394;&#31561;</span><br></pre></td></tr></table></figure></p>
<h1 id="开启鼠标生效">开启鼠标生效</h1><p>set-option -g mouse on</p>
<h1 id="设置前缀为Ctrl_+_x">设置前缀为Ctrl + x</h1><p>set -g prefix C-x<br>unbind C-b</p>
<h1 id="key_bindings_for_horizontal_and_vertical_panes">key bindings for horizontal and vertical panes</h1><p>unbind %<br>bind | split-window -h      # 使用|竖屏，方便分屏<br>unbind ‘“‘<br>bind - split-window -v      # 使用-横屏，方便分屏</p>
<h1 id="status_bar_with_load_and_time">status bar with load and time</h1><p>set -g status-bg blue<br>set -g status-fg ‘#bbbbbb’<br>set -g status-left-fg green<br>set -g status-left-bg blue<br>set -g status-right-fg green<br>set -g status-right-bg blue<br>set -g status-left-length 90<br>set -g status-right-length 90<br>set -g status-left ‘[#(whoami)]’<br>set -g status-right ‘[#(date +” %m-%d %H:%M “)]’<br>set -g status-justify “centre”<br>set -g window-status-format ‘#I #W’<br>set -g window-status-current-format ‘ #I #W ‘<br>setw -g window-status-current-bg blue<br>setw -g window-status-current-fg green</p>
<h1 id="pane_number_display">pane number display</h1><p>set -g display-panes-active-colour colour33 #blue<br>set -g display-panes-colour colour166 #orange<br>set -g base-index 1<br>set -g pane-base-index 1<br>set -g display-time 3000<br>set -g history-limit 10000</p>
<h1 id="copy-mode_将快捷键设置为_vi_模式">copy-mode 将快捷键设置为 vi 模式</h1><p>setw -g mode-keys vi</p>
<h1 id="选中窗口">选中窗口</h1><p>bind-key k select-pane -U<br>bind-key j select-pane -D<br>bind-key h select-pane -L<br>bind-key l select-pane -R<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">2. </span>~/.bash_rc配置登录时自动进入tmux</span><br></pre></td></tr></table></figure></p>
<p>tmux_init()<br>{<br>    tmux new-session -s “xiaoyong” -d -n “local”    # 开启一个会话<br>    tmux new-window -n “other”          # 开启一个窗口<br>    tmux split-window -h                # 开启一个竖屏<br>    tmux split-window -v                # 开启一个横屏<br>    tmux -2 attach-session -d           # tmux -2强制启用256color，连接已开启的tmux<br>}</p>
<h1 id="判断是否已有开启的tmux会话，没有则开启">判断是否已有开启的tmux会话，没有则开启</h1><p>if which tmux 2&gt;&amp;1 &gt;/dev/null; then<br>    test -z “$TMUX” &amp;&amp; (tmux attach || tmux_init)<br>fi<br>```</p>
<h4 id="参考链接">参考链接</h4><ol>
<li><a href="http://wdxtub.com/2016/03/30/tmux-guide/" target="_blank" rel="external">tmux指南</a></li>
<li><strong> tmux如何将内容复制到系统clipboard ? </strong> Mac下如果用 iterm2 可以在 preference 下选择 Applications in terminal may access  clipboard</li>
</ol>

        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="tags/Linux/"> #Linux </a>
          
            <a href="tags/tmux/"> #tmux </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2017/12/02/Mysql Init线程不安全问题/">
                Mysql初次Init线程不安全问题
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2017-12-02
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="2017/12/02/Mysql Init线程不安全问题/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2017/12/02/Mysql Init线程不安全问题/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <h4 id="现象描述">现象描述</h4><p>沙盒测试时发现的这个问题，在程序启动时偶发core，而且不稳定复现，查看core信息会发现core在了mysql连接上；而且最后发现的规律是每次程序启动时，如果多线程获取数据库连接，就可能出现core。core信息如图所示:</p>
<p><img src="https://raw.githubusercontent.com/Charles-Xiao/Charles-Xiao.github.io/master/images/mysql_core.png" class="full-image"></p>
<h4 id="代码复现">代码复现</h4><p>在主线程内初始化mysql，在子线程内调用mysql_real_connect,就会导致coredump</p>
<pre><code><span class="variable">#include</span> <span class="subst">&lt;</span>mysql<span class="built_in">.</span>h<span class="subst">&gt;</span>
<span class="variable">#include</span> <span class="subst">&lt;</span>pthread<span class="built_in">.</span>h<span class="subst">&gt;</span>
<span class="literal">void</span><span class="subst">*</span> func(<span class="literal">void</span><span class="subst">*</span> arg)
{
    MYSQL<span class="subst">*</span> mysql <span class="subst">=</span> (MYSQL <span class="subst">*</span>)arg;
    mysql_real_connect(mysql, “<span class="number">127.0</span><span class="built_in">.0</span><span class="built_in">.1</span>″, “root”, “<span class="number">123456</span>″, “chen”, <span class="number">1234</span>, <span class="built_in">NULL</span>, <span class="number">0</span>);
    mysql_close(mysql);
    <span class="keyword">return</span> (<span class="literal">void</span> <span class="subst">*</span>)<span class="number">0</span>;
}

int main()
{
    MYSQL mysql;
    <span class="keyword">if</span> (<span class="built_in">NULL</span> <span class="subst">==</span> mysql_init(<span class="subst">&amp;</span>mysql))
    {
        <span class="keyword">return</span> <span class="subst">-</span><span class="number">1</span>;
    }
    pthread_t <span class="keyword">thread</span>;
    pthread_create(<span class="subst">&amp;</span><span class="keyword">thread</span>, <span class="built_in">NULL</span>, func, <span class="subst">&amp;</span>mysql);
    pthread_join(<span class="keyword">thread</span>, <span class="built_in">NULL</span>);
    <span class="keyword">return</span> <span class="number">0</span>;
}
</code></pre><h4 id="出现原因">出现原因</h4><p>如官网文档所说，当我们调用<code>mysql_real_connect()</code>函数去获取数据库连接时，需要先调用<code>mysql_init(MYSQL *mysql)函数</code>去获取一个MYSQL connection handler，然而mysql_init()不是完全线程安全的，但是只要成功调用一次后就线程安全了，如果有多线程并发调用mysql_init()，第一次init时如果刚好多线程并发调用，就会出core；为啥第一次调用mysql_init时线程不安全？我们可以来看看mysql源码:</p>
<ol>
<li><p>mysql.h文件预定义<code>mysql_library_init</code>函数</p>
<pre><code><span class="hexcolor">#def</span>ine mysql_library_init mysql_server_init
</code></pre></li>
<li><p>client.c文件定义<code>mysql_init</code>函数,并调用<code>mysql_server_init</code>函数</p>
<pre><code><span class="comment">// Init MySQL structure or allocate one</span>

MYSQL <span class="subst">*</span> STDCALL
mysql_init(MYSQL <span class="subst">*</span>mysql)
{
  <span class="keyword">if</span> (mysql_server_init(<span class="number">0</span>, <span class="built_in">NULL</span>, <span class="built_in">NULL</span>))
    <span class="keyword">return</span> <span class="number">0</span>;
  <span class="keyword">if</span> (<span class="subst">!</span>mysql)
  {
    <span class="keyword">if</span> (<span class="subst">!</span>(mysql<span class="subst">=</span>(MYSQL<span class="subst">*</span>) my_malloc(sizeof(<span class="subst">*</span>mysql),MYF(MY_WME <span class="subst">|</span> MY_ZEROFILL))))
    {
      set_mysql_error(<span class="built_in">NULL</span>, CR_OUT_OF_MEMORY, unknown_sqlstate);
      <span class="keyword">return</span> <span class="number">0</span>;
    }
    mysql<span class="subst">-&gt;</span>free_me<span class="subst">=</span><span class="number">1</span>;
  }
  <span class="keyword">else</span>
    memset(mysql, <span class="number">0</span>, sizeof(<span class="subst">*</span>(mysql)));
  mysql<span class="subst">-&gt;</span>charset<span class="subst">=</span>default_client_charset_info;
  strmov(mysql<span class="subst">-&gt;</span>net<span class="built_in">.</span>sqlstate, not_error_sqlstate);

  <span class="comment">/*
    Only enable LOAD DATA INFILE by default if configured with option
    ENABLED_LOCAL_INFILE
  */</span>

<span class="variable">#if</span> defined(ENABLED_LOCAL_INFILE) <span class="subst">&amp;&amp;</span> <span class="subst">!</span>defined(MYSQL_SERVER)
  mysql<span class="subst">-&gt;</span>options<span class="built_in">.</span>client_flag<span class="subst">|=</span> CLIENT_LOCAL_FILES;
<span class="variable">#endif</span>

<span class="variable">#ifdef</span> HAVE_SMEM
  mysql<span class="subst">-&gt;</span>options<span class="built_in">.</span>shared_memory_base_name<span class="subst">=</span> (char<span class="subst">*</span>) def_shared_memory_base_name;
<span class="variable">#endif</span>

  mysql<span class="subst">-&gt;</span>options<span class="built_in">.</span>methods_to_use<span class="subst">=</span> MYSQL_OPT_GUESS_CONNECTION;
  mysql<span class="subst">-&gt;</span>options<span class="built_in">.</span>report_data_truncation<span class="subst">=</span> <span class="literal">TRUE</span>;  <span class="comment">/* default */</span>

  mysql<span class="subst">-&gt;</span>reconnect<span class="subst">=</span> <span class="number">0</span>;

  mysql<span class="subst">-&gt;</span>options<span class="built_in">.</span>secure_auth<span class="subst">=</span> <span class="literal">TRUE</span>;

  <span class="keyword">return</span> mysql;
}
</code></pre></li>
<li><p>libmysql.c文件定义<code>mysql_server_init</code>函数, 问题就出在这个函数,用了<code>mysql_client_init</code>这个标记量来判断是否需要调用<code>my_thread_init</code>函数，如果<code>mysql_client_init==1</code>就直接为每个线程初始化私有变量，否则会先去初始化一些全局性的系统函数，资源和变量; 所以如果第一次init时出现多线程并发情景，线程A将<code>mysql_client_init</code>变量置为1，紧接着初始化全局资源，与此同时线程B走了else分支，直接开始调用<code>my_thread_init</code>函数，此时就会报错了，core由此产生。</p>
<pre><code><span class="type">int</span> <span class="type">STDCALL</span> mysql_server_init(<span class="type">int</span> argc __attribute__((unused)),
                  <span class="type">char</span> **argv __attribute__((unused)),
                  <span class="type">char</span> **groups __attribute__((unused)))
{
  <span class="type">int</span> <span class="literal">result</span>= <span class="number">0</span>;
  <span class="keyword">if</span> (!mysql_client_init)
  {
    mysql_client_init=<span class="number">1</span>;
    org_my_init_done=my_init_done;
    <span class="keyword">if</span> (my_init())                /* <span class="type">Will</span> init threads */
      <span class="keyword">return</span> <span class="number">1</span>;
    init_client_errs();
    <span class="keyword">if</span> (mysql_client_plugin_init())
      <span class="keyword">return</span> <span class="number">1</span>;
    <span class="keyword">if</span> (!mysql_port)
    {
      <span class="type">char</span> *env;
      struct servent *serv_ptr __attribute__((unused));

      mysql_port = <span class="type">MYSQL_PORT</span>;

      /*
        <span class="keyword">if</span> builder specifically requested a default port, use that
        (even <span class="keyword">if</span> it coincides <span class="keyword">with</span> our factory default).
        only <span class="keyword">if</span> they didn't <span class="keyword">do</span> we check /etc/services (<span class="keyword">and</span>, failing
        on that, fall back to the factory default <span class="keyword">of</span> <span class="number">3306</span>).
        either default can be overridden by the environment variable
        <span class="type">MYSQL_TCP_PORT</span>, which <span class="keyword">in</span> turn can be overridden <span class="keyword">with</span> command
        line options.
      */

<span class="comment">#if MYSQL_PORT_DEFAULT == 0</span>
      <span class="keyword">if</span> ((serv_ptr= getservbyname(<span class="string">"mysql"</span>, <span class="string">"tcp"</span>)))
        mysql_port= (<span class="type">uint</span>) ntohs((ushort) serv_ptr-&gt;s_port);
<span class="comment">#endif</span>
      <span class="keyword">if</span> ((env= getenv(<span class="string">"MYSQL_TCP_PORT"</span>)))
        mysql_port=(<span class="type">uint</span>) atoi(env);
    }

    <span class="keyword">if</span> (!mysql_unix_port)
    {
      <span class="type">char</span> *env;
<span class="comment">#ifdef __WIN__</span>
      mysql_unix_port = (<span class="type">char</span>*) <span class="type">MYSQL_NAMEDPIPE</span>;
<span class="comment">#else</span>
      mysql_unix_port = (<span class="type">char</span>*) <span class="type">MYSQL_UNIX_ADDR</span>;
<span class="comment">#endif</span>
      <span class="keyword">if</span> ((env = getenv(<span class="string">"MYSQL_UNIX_PORT"</span>)))
    mysql_unix_port = env;
    }
    mysql_debug(<span class="type">NullS</span>);
<span class="comment">#if defined(SIGPIPE) &amp;&amp; !defined(__WIN__)</span>
    (<span class="type">void</span>) signal(<span class="type">SIGPIPE</span>, <span class="type">SIG_IGN</span>);
<span class="comment">#endif</span>
<span class="comment">#ifdef EMBEDDED_LIBRARY</span>
    <span class="keyword">if</span> (argc &gt; -<span class="number">1</span>)
       <span class="literal">result</span>= init_embedded_server(argc, argv, groups);
<span class="comment">#endif</span>
  }
  <span class="keyword">else</span>
    <span class="literal">result</span>= (<span class="type">int</span>)my_thread_init();         /* <span class="type">Init</span> <span class="keyword">if</span> new thread */
  <span class="keyword">return</span> <span class="literal">result</span>;
}
</code></pre></li>
<li><p>官方文档</p>
<ul>
<li><p><a href="https://dev.mysql.com/doc/refman/5.7/en/mysql-real-connect.html" target="_blank" rel="external"><code>mysql_real_connect()</code></a> attempts to establish a connection to a MySQL database engine running on host. mysql_real_connect() must complete successfully before you can execute any other API functions that require a valid MYSQL connection handler structure.  </p>
</li>
<li><p><a href="https://dev.mysql.com/doc/refman/5.7/en/mysql-init.html" target="_blank" rel="external"><code>MYSQL *mysql_init(MYSQL *mysql)</code></a>  </p>
<p>  Allocates or initializes a MYSQL object suitable for <code>mysql_real_connect()</code>. If mysql is a NULL pointer, the function allocates, initializes, and returns a new object. Otherwise, the object is initialized and the address of the object is returned. If <code>mysql_init()</code> allocates a new object, it is freed when <code>mysql_close()</code> is called to close the connection.  </p>
<p>  In a nonmulti-threaded environment, <code>mysql_init()</code> invokes <code>mysql_library_init()</code> automatically as necessary. However, <code>mysql_library_init()</code> is not thread-safe in a multi-threaded environment, and thus neither is <code>mysql_init()</code>. Before calling <code>mysql_init()</code>, either call <code>mysql_library_init()</code> prior to spawning any threads, or use a mutex to protect the <code>mysql_library_init()</code> call. This should be done prior to any other client library call.</p>
</li>
</ul>
</li>
</ol>
<h4 id="解决方案">解决方案</h4><ol>
<li>每一次连接数据库时都先后加锁调用mysql_init()和mysql_real_connect()，确保init先于connect函数被调用过，而且不会被其他线程并发调用，以免初次连接数据库时多线程并发导致core</li>
<li>在程序启动时先全局调用一次mysql_init()函数，确保初次调用mysql_init时是线程安全的，之后的调用mysql_real_connect函数就不会出core</li>
<li>MySQL提供了线程安全的库libmysql_r，可以考虑替换原来的线程不安全的libmysql库</li>
</ol>

        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="tags/Mysql/"> #Mysql </a>
          
            <a href="tags/bug/"> #bug </a>
          
            <a href="tags/databse/"> #databse </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2017/02/19/Linux shell:目录基础知识/">
                Linux shell/目录基础知识
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2017-02-19
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="2017/02/19/Linux shell:目录基础知识/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/19/Linux shell:目录基础知识/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <h4 id="bash配置文件(Linux_or_Mac)">bash配置文件(Linux or Mac)</h4><h5 id="全局配置文件">全局配置文件</h5><ol>
<li>/etc/profile 和 /rtc/profile.d/*.sh : 此文件为系统的每个用户设置环境信息,当用户第一次登录时该文件被执行，并从/etc/profile.d目录的配置文件中搜集shell的设置</li>
<li>/etc/bashrc : 为每一个运行bash shell的用户执行此文件，当bash shell被打开时,该文件被读取</li>
</ol>
<h5 id="个人配置文件">个人配置文件</h5><ol>
<li>~/.bash_profile : 每个用户都可使用该文件输入专用于自己使用的shell信息；当用户登录时,该文件仅仅执行一次；默认情况下,他设置一些环境变量,执行用户的.bashrc文件</li>
<li>~/.bashrc : 该文件包含专用于你的bash shell的bash信息,当登录时以及每次打开新的shell时,该文件被读取</li>
<li>~/.bash_history : </li>
<li>~/.bash_logout : 当每次退出系统(退出bash shell)时,执行该文件</li>
</ol>
<h5 id="shell如何读取配置文件">shell如何读取配置文件</h5><ol>
<li><p><strong>登录式shell如何读取配置文件</strong>  </p>
<pre><code><span class="comment">/etc/profile</span> <span class="literal">-</span><span class="literal">-</span>&gt; <span class="comment">/etc/profile</span><span class="string">.</span><span class="comment">d/*</span><span class="string">.</span><span class="comment">sh</span> <span class="literal">-</span><span class="literal">-</span>&gt; <span class="comment">~/</span><span class="string">.</span><span class="comment">bash_profile</span> <span class="literal">-</span><span class="literal">-</span>&gt; <span class="comment">~/</span><span class="string">.</span><span class="comment">bashrc</span> <span class="literal">-</span><span class="literal">-</span>&gt; <span class="comment">/etc/bashrc</span>
</code></pre></li>
<li><p>非登录式shell如何配置文件</p>
<pre><code>~<span class="regexp">/.bashrc --&gt; /etc</span><span class="regexp">/bashrc --&gt; /etc</span><span class="regexp">/profile.d/</span>*.sh  
</code></pre></li>
</ol>
<h5 id="配置变量和命令">配置变量和命令</h5><ol>
<li><p>$PATH : 决定了shell将到哪些目录中寻找命令或程序，PATH的值是一系列目录，当您运行一个程序时，Linux在这些目录下进行搜寻编译链接  </p>
<pre><code><span class="comment"># 设置PATH, PATH N 为自己加上指定路径，中间用冒号隔开</span>
<span class="variable">$ </span><span class="constant">PATH=</span><span class="variable">$PATH</span><span class="symbol">:PATH1</span><span class="symbol">:PATH</span> <span class="number">2</span><span class="symbol">:PATH</span> <span class="number">3</span><span class="symbol">:</span> ... <span class="symbol">:PATH</span> <span class="constant">N</span>
<span class="comment"># 打印当前搜索路径的两种方法</span>
<span class="variable">$ </span>echo <span class="variable">$PATH</span> 或者 <span class="variable">$ </span>export
</code></pre></li>
<li><p>export : 该命令将新变量添加到环境中 ; 在命令行直接执行可以设置一个新的临时环境变量, 变量在关闭shell时失效</p>
</li>
<li>source .bash_profile : 使设置的PATH生效</li>
<li>每次重新打开终端的时候，.bashrc会自动执行一次，而.bash_profile不会</li>
</ol>
<h4 id="shell和shell脚本的概念">shell和shell脚本的概念</h4><p><strong>shell</strong>是指一种应用程序，这个应用程序提供了一个界面，用户通过这个界面访问操作系统内核的服务。Ken Thompson的sh是第一种Unix Shell，Windows Explorer是一个典型的图形界面Shell。</p>
<p><strong>shell脚本（shell script）</strong>，是一种为shell编写的脚本程序。业界所说的shell通常都是指shell脚本，但读者朋友要知道，shell和shell script是两个不同的概念。本文出现的“shell编程”都是指shell脚本编程，不是指开发shell自身（如Windows Explorer扩展开发）</p>
<h4 id="脚本解释器">脚本解释器</h4><p><strong>sh</strong> —- 即Bourne shell，POSIX（Portable Operating System Interface）标准的shell解释器，它的二进制文件路径通常是/bin/sh，由Bell Labs开发。</p>
<p><strong>Bash</strong> —- 是Bourne shell的替代品，属GNU Project，二进制文件路径通常是/bin/bash。</p>
<p><strong>ksh、csh、zsh等不常用的解释器</strong></p>
<h4 id="shell脚本实例">shell脚本实例</h4><pre><code><span class="shebang">#!/bin/sh</span>
<span class="built_in">cd</span> ~
mkdir shell_tut
<span class="built_in">cd</span> shell_tut

<span class="keyword">for</span> ((i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++)); <span class="keyword">do</span>
    touch <span class="built_in">test</span>_<span class="variable">$i</span>.txt
<span class="keyword">done</span>
</code></pre><ol>
<li>定义变量时，变量名不加美元符号（$）</li>
<li>变量名和等号之间不能有空格</li>
<li>单引号里的任何字符都会原样输出，单引号字符串中的变量是无效的；单引号字串中不能出现单引号（对单引号使用转义符后也不行）</li>
<li>双引号里可以有变量，双引号里可以出现转义字符</li>
<li>以“#”开头的行就是注释，会被解释器忽略</li>
</ol>
<h4 id="运行Shell脚本的两种方法">运行Shell脚本的两种方法</h4><pre><code>chmod +x <span class="keyword">test</span>.<span class="keyword">sh</span>
./<span class="keyword">test</span>.<span class="keyword">sh</span>
或者
bin/<span class="keyword">sh</span> <span class="keyword">test</span>.<span class="keyword">sh</span>
/bin/php <span class="keyword">test</span>.php
第一种必须要带上.才能在当前目录寻找脚本，否则会去PATH寻找；第二种不需要指定#!/bin/<span class="keyword">sh</span>
</code></pre><h4 id="Linux/Mac常见目录">Linux/Mac常见目录</h4><ol>
<li>/bin 存放系统管理员和普通用户都要使用的程序</li>
<li>/sbin 存放用于系统恢复，系统启动，系统维护等程序</li>
<li>/usr/bin 登录用户可以使用的预装程序一般都放在这里,会随着系统升级而改变</li>
<li>/usr/share/bin 可以通过web访问的程序一般放在这里</li>
<li>/usr/local/bin 目录是给用户放置自己的可执行程序的地方，是手动编译或者安装的程序, 不会被系统升级而覆盖同名文件</li>
<li>usr 指 Unix System Resource，而不是User</li>
<li>/lib目录都是为/bin, /sbin准备的;一个应用程序启动的时候，会在/lib 和 /usr/lib库中查找动态库</li>
</ol>
<h4 id="Linux常用的查找命令"><a href="http://www.ruanyifeng.com/blog/2009/10/5_ways_to_search_for_files_using_the_terminal.html" target="_blank" rel="external">Linux常用的查找命令</a></h4><p>find/locate, whereis/which/ps -ef, grep</p>

        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="tags/Linux/"> #Linux </a>
          
            <a href="tags/shell/"> #shell </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2017/02/05/Git使用指南/">
                Git使用指南
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2017-02-05
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="2017/02/05/Git使用指南/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/05/Git使用指南/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>Git是一个分布式版本控制系统，区别于SVN等集中式版本控制系统。集中式版本控制系统的版本库是集中存放在中央服务器的，每次工作时都需要先去中央服务器拉取最新代码，在本地修改之后，再推送至中央服务器；而分布式版本控制系统是不存在中央服务器的，每台电脑都是一个版本库，本地不联网也是可以工作的，而且代码更加安全，不用担心中央服务器出问题；当然多台电脑之间文件修改的交换与同步同样需要一台服务器来作为桥梁，比如github网站或者gitLab。此外，Git在开发流程、团队协作和分支管理方面的优点同样让其备受技术团队的欢迎。</p>
<h3 id="Git原理图">Git原理图</h3><h3 id="Git常用操作命令">Git常用操作命令</h3><h3 id="Git_Flow开发流程">Git Flow开发流程</h3>
        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="tags/Git/"> #Git </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2017/01/15/从菊与刀初探日本文化/">
                从菊与刀初探日本文化
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2017-01-14
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="categories/读书札记/">读书札记</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="2017/01/15/从菊与刀初探日本文化/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/15/从菊与刀初探日本文化/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>说到日本文化，我其实是不太感兴趣的，应该说是因为从小到大接触的少，如果接触得多说不定也会很感兴趣；然而身边有些朋友对日本文化表现出了很深的兴趣，不管是漫画还是电影还是其他。可以说，在我这一代人里边应该是有不少人收到日本文化影响的，包括大部分二次元的东西应该都是起源于日本。我想，日本文化是必有其过人之处的，否则不太可能有这么的输出力。抱着了解的心态，我从亚马逊下单了《菊与刀》，趁着每日睡前读完了它，一探日本文化。
          <div class="post-more-link text-center">
            <a class="btn" href="2017/01/15/从菊与刀初探日本文化/#more">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="tags/日本/"> #日本 </a>
          
            <a href="tags/菊与刀/"> #菊与刀 </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2016/12/28/Ruby入门基础知识集锦/">
                Ruby入门基础知识集锦
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2016-12-28
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="categories/Ruby/">Ruby</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="2016/12/28/Ruby入门基础知识集锦/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/28/Ruby入门基础知识集锦/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>Ruby是一种纯粹的面向对象编程语言, 类似于 Python 和 Perl 等服务器端脚本语言; 既可以用来编写通用网关接口（CGI）脚本，也可以被嵌入到超文本标记语言（HTML), 语法简单，快速上手，是个人开发者的利器;再加上Ruby on Rails 开发框架，也是一枚轻量级web开发的利器。本文主要包括部分ruby基础语法和部分易淆点。</p>
<h3 id="变量/常量">变量/常量</h3><ul>
<li>一般小写字母、下划线开头：变量（Variable）</li>
<li>$开头：全局变量（Global variable）;未初始化的全局变量的值为 nil，在使用 -w 选项后，会产生警告</li>
<li>@开头：实例变量（Instance variable）</li>
<li>@@开头：类变量（Class variable）类变量被共享在整个继承链中</li>
<li>大写字母开头：常数（Constant）,类名称,模块名称</li>
<li></li>
</ul>

        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="tags/Ruby/"> #Ruby </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2016/12/23/Redis基础知识/">
                Redis基础知识
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2016-12-23
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="2016/12/23/Redis基础知识/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/23/Redis基础知识/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <h4 id="Redis事务">Redis事务</h4><ol>
<li>Redis中的事务(transaction)是一组命令的集合。事务同命令一样都是Redis最小的执行单位，一个事务中的命令要么都执行，要么都不执行。但是<strong>Redis只能保证一个client发起的事务中的命令可以连续的执行，而中间不会插入其他client的命令</strong></li>
<li>Redis是单线程来处理所有client的请求的。一般情况下redis在接受到一个client发来的命令后会立即处理并返回处理结果</li>
<li><strong>如果使用事务</strong>：client发出multi命令，进入事务上下文，client后续发出的所有命令都被放到一个队列中，直到redis接收到exec命令，redis开始顺序执行队列中的命令，并将执行结果一起返回给client，该事务结束</li>
</ol>
<h4 id="Redis管道pipeline">Redis管道pipeline</h4><ol>
<li>Redis是一个cs模式的tcp server，使用和http类似的请求响应协议。一个client可以通过一个socket连接发起多个请求命令。每个请求命令发出后client通常会阻塞并等待redis服务处理，redis处理完后请求命令后会将结果通过响应报文返回给client。</li>
<li>除了可以利用mget,mset 之类的单条命令处理多个key的命令外我们还可以利用pipeline的方式从client打包多条命令一起发出，不需要等待单条命令的响应返回，而redis服务端会处理完多条命令后会将多条命令的处理结果打包到一起返回给客户端。当一组命令中每条命令都不依赖于之前命令的执行结果时就可以将这组命令一起通过管道发出。管道通过减少客户端与Redis的通信次数来实现降低往返时延累计值的目的(因为通信延迟往往比较久, 将多个命令打包到一条TCP报文，然后让redis并行处理，然后一次性返回结果)</li>
<li>用pipeline方式打包命令发送，redis必须在处理完所有命令前先缓存起所有命令的处理结果。打包的命令越多，缓存消耗内存也越多。所以并是不是打包的命令越多越好。</li>
</ol>

        
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="tags/Redis/"> #Redis </a>
          
        </div>
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
  </div>

  
  <div class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="page/7/">7</a><a class="extend next" rel="next" href="page/2/">&raquo;</a>
  </div>


        </div>

        
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="/images/avatar.jpg" alt="CharlesXiao" />
          <p class="site-author-name">CharlesXiao</p>
        </div>
        <p class="site-description motion-element">在码农炼成之路不断挣扎……stay hungry……keep learning……</p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">54</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">17</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">61</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </div>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
              <a href="https://github.com/Charles-Xiao" target="_blank">github</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://weibo.com/2262300105/profile?topnav=1&wvr=6" target="_blank">weibo</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://daijiale.github.io/" target="_blank">Daijiale的个人站点</a>
            </span>
            
          
        </div>

        
        

      </div>

      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp;  2015.05.16 - 
  2017
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">CharlesXiao</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('.content img').each(function () {
        var $image = $(this);
        var $imageWrapLink = $image.parent('a');

        if ($imageWrapLink.size() < 1) {
          $imageWrapLink = $image.wrap('<a href="' + this.getAttribute('src') + '"></a>').parent('a');
        }
        $imageWrapLink.addClass('fancybox');
      });
    });
    $('.fancybox').fancybox({
      helpers: {
        overlay: {
          locked: false
        }
      }
    });
  </script>


  <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;

    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }
</script>

  

  <script type="text/javascript" src="vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" id="motion.global">
  $(document).ready(function () {
    var body = $('body');
    var isSidebarVisible = false;
    var sidebarToggle = $('.sidebar-toggle');
    var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
    var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
    var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
    var sidebar = $('.sidebar');

    var SIDEBAR_WIDTH = '320px';
    var SIDEBAR_DISPLAY_DURATION = 300;

    var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

    var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
    var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

    var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine2ndStatusArrow = {width: '90%'};
    var sidebarToogleLine2ndStatusClose = {opacity: 0};

    var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
    var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

    LogoAndMenuMotion();
    sidebatToggleMotion();
    postsListMotion();
    backToTopMotion();


    $(document)
      .on('sidebar.isShowing', function () {
        isDesktop() && body.velocity(
          {paddingRight: SIDEBAR_WIDTH},
          SIDEBAR_DISPLAY_DURATION
        );
        sidebarContentMotion();
      })
      .on('sidebar.isHiding', function () {});

    function LogoAndMenuMotion() {
      $.Velocity.RunSequence([
        { e: $('.brand'), p: { opacity: 1 }, o: { duration: 100 } },
        { e: $('.logo'), p: { opacity: 1, top: 0 }, o: { duration: 50} },
        
        { e: $('.logo-line-before i'), p: { translateX: "100%" }, o: { duration: 500, sequenceQueue: false } },
        { e: $('.logo-line-after i'), p: { translateX: "-100%" }, o: { duration: 500, sequenceQueue: false } },
        
        { e: $('.site-title'), p: { opacity: 1, top: 0 }, o: { duration: 200 } }
      ]);
      $('.menu-item').velocity('transition.slideDownIn', {display: null});
    }


    function backToTopMotion () {
      var b2top = $('.back-to-top');
      b2top.on('click', function () {
        body.velocity('scroll');
      });
    }

    function sidebarShowMotion () {

      sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
      sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
      sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

      sidebar.velocity({width: SIDEBAR_WIDTH}, {
        display: 'block',
        duration: SIDEBAR_DISPLAY_DURATION,
        complete: function () {
          sidebar.addClass('sidebar-active');
          sidebar.trigger('sidebar.didShow');
        }
      });
      sidebar.trigger('sidebar.isShowing');
    }

    function sidebarHideMotion () {
      isDesktop() && body.velocity({paddingRight: 0});
      sidebar.velocity('reverse');

      sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
      sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
      sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);

      sidebar.removeClass('sidebar-active');
      sidebar.trigger('sidebar.isHiding');
    };

    function sidebarContentMotion () {
      $('.sidebar .motion-element').velocity(
        'transition.slideRightIn',
        {stagger: 50, drag: true}
      );
    }

    function postsListMotion () {
      var postMotionOptions = window.postMotionOptions || {stagger: 300, drag: true};
      $('.post').velocity('transition.slideDownIn', postMotionOptions);
    }

    function sidebatToggleMotion () {
      sidebarToggle.on('click', function () {
        isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
        isSidebarVisible = !isSidebarVisible;
      });

      sidebarToggle.hover(function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
      }, function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
      });
    }
  });

</script>





  

  
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  
  
  


  

  
</body>
</html>
